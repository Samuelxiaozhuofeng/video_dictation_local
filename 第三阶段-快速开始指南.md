# ç¬¬ä¸‰é˜¶æ®µæ‹†åˆ† - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ¯ ç›®æ ‡

å°† App.tsx ä» **758 è¡Œ** å‡å°‘åˆ° **~450 è¡Œ**ï¼ˆå‡å°‘ 40%ï¼‰

## ğŸ“ æœ€ç®€å•çš„å®æ–½æ–¹æ¡ˆï¼ˆåªåšæ­¥éª¤ä¸€ï¼‰

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º PracticeLayout.tsx

åœ¨ `components/` ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ `PracticeLayout.tsx`

```typescript
import React from 'react';
import {
  Play, Pause, SkipBack, SkipForward, Volume2, VolumeX,
  RotateCcw, Bookmark, X, Trash2, PlayCircle, PlusCircle,
  Check, Mic, ChevronLeft, ChevronRight
} from 'lucide-react';
import { PracticeMode, Subtitle, VideoSection, AnkiConfig } from '../types';
import * as Storage from '../utils/storage';
import InputFeedback from './InputFeedback';

interface PracticeLayoutProps {
  // å­—å¹•å’Œåˆ†æ®µ
  subtitles: Subtitle[];
  fullSubtitles: Subtitle[];
  sections: VideoSection[];
  currentSectionIndex: number;
  currentSubtitleIndex: number;
  
  // ç»ƒä¹ çŠ¶æ€
  mode: PracticeMode;
  showSectionComplete: boolean;
  
  // è§†é¢‘æ§åˆ¶
  videoRef: React.RefObject<HTMLVideoElement>;
  videoSrc: string | null;
  isPlaying: boolean;
  volume: number;
  playbackSpeed: number;
  progress: number;
  
  // Saved Lines
  savedIds: Set<number>;
  showSavedList: boolean;
  savedItems: Subtitle[];
  isCurrentSaved: boolean;
  
  // Anki
  ankiConfig: AnkiConfig | null;
  ankiStatus: 'idle' | 'recording' | 'adding' | 'success' | 'error';
  
  // äº‹ä»¶å¤„ç†
  onExit: () => void;
  onSwitchSection: (index: number) => void;
  onToggleSavedList: (show: boolean) => void;
  onTogglePlay: () => void;
  onReplayCurrent: (autoAdvanceAfter?: boolean) => void;
  onSkip: (direction: 'prev' | 'next') => void;
  onProgressSeek: (e: React.ChangeEvent<HTMLInputElement>) => void;
  onToggleSaveCurrent: () => void;
  onAddToAnki: () => void;
  onWordToAnki: (word: string, definition: string) => void;
  onNextSection: () => void;
  onSetShowSectionComplete: (show: boolean) => void;
  onSetVolume: (volume: number) => void;
  onSetPlaybackSpeed: (speed: number) => void;
  onInputComplete: (wasCorrect: boolean) => void;
  onContinue: () => void;
  onDeleteSavedItem: (id: number, e: React.MouseEvent) => void;
  onJumpToSaved: (id: number) => void;
}

export default function PracticeLayout(props: PracticeLayoutProps) {
  const {
    subtitles, sections, currentSectionIndex, currentSubtitleIndex,
    mode, showSectionComplete, videoRef, videoSrc, isPlaying,
    volume, playbackSpeed, progress, savedIds, showSavedList,
    savedItems, isCurrentSaved, ankiConfig, ankiStatus,
    onExit, onSwitchSection, onToggleSavedList, onTogglePlay,
    onReplayCurrent, onSkip, onProgressSeek, onToggleSaveCurrent,
    onAddToAnki, onWordToAnki, onNextSection, onSetShowSectionComplete,
    onSetVolume, onSetPlaybackSpeed, onInputComplete, onContinue,
    onDeleteSavedItem, onJumpToSaved
  } = props;

  const currentSub = subtitles[currentSubtitleIndex];

  return (
    // å°† App.tsx çš„ 476-757 è¡Œçš„ JSX å¤åˆ¶åˆ°è¿™é‡Œ
    // æ›¿æ¢æ‰€æœ‰çš„çŠ¶æ€å¼•ç”¨ä¸º props
    // æ›¿æ¢æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨ä¸º props ä¸­çš„å›è°ƒ
  );
}
```

### ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ App.tsx

åœ¨ App.tsx ä¸­ï¼Œæ‰¾åˆ° PRACTICE æ¨¡å¼çš„æ¸²æŸ“éƒ¨åˆ†ï¼ˆ471-758 è¡Œï¼‰ï¼Œæ›¿æ¢ä¸ºï¼š

```typescript
// åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  import
import PracticeLayout from './components/PracticeLayout';

// åœ¨ App ç»„ä»¶ä¸­ï¼Œæ›¿æ¢ PRACTICE æ¸²æŸ“éƒ¨åˆ†
if (appState === AppState.PRACTICE) {
  const currentSub = subtitles[currentSubtitleIndex];
  const isCurrentSaved = savedLinesIsCurrentSaved(currentSub);

  return (
    <PracticeLayout
      subtitles={subtitles}
      fullSubtitles={fullSubtitles}
      sections={sections}
      currentSectionIndex={currentSectionIndex}
      currentSubtitleIndex={currentSubtitleIndex}
      mode={mode}
      showSectionComplete={showSectionComplete}
      videoRef={videoRef}
      videoSrc={videoSrc}
      isPlaying={isPlaying}
      volume={volume}
      playbackSpeed={playbackSpeed}
      progress={progress}
      savedIds={savedIds}
      showSavedList={showSavedList}
      savedItems={savedItems}
      isCurrentSaved={isCurrentSaved}
      ankiConfig={ankiConfig}
      ankiStatus={ankiStatus}
      onExit={() => setAppState(AppState.UPLOAD)}
      onSwitchSection={(index) => switchSection(index, videoRef, setIsPlaying)}
      onToggleSavedList={setShowSavedList}
      onTogglePlay={togglePlay}
      onReplayCurrent={handleReplayCurrent}
      onSkip={handleSkip}
      onProgressSeek={handleProgressSeek}
      onToggleSaveCurrent={toggleSaveCurrent}
      onAddToAnki={handleAddToAnki}
      onWordToAnki={handleWordToAnki}
      onNextSection={handleNextSectionClick}
      onSetShowSectionComplete={setShowSectionComplete}
      onSetVolume={setVolume}
      onSetPlaybackSpeed={setPlaybackSpeed}
      onInputComplete={handleInputComplete}
      onContinue={handleContinue}
      onDeleteSavedItem={deleteSavedItem}
      onJumpToSaved={jumpToSaved}
    />
  );
}
```

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯

1. è¿è¡Œ `npm run dev`
2. æµ‹è¯• PRACTICE æ¨¡å¼çš„æ‰€æœ‰åŠŸèƒ½
3. ç¡®ä¿æ²¡æœ‰é”™è¯¯

## âœ… å®Œæˆï¼

å®Œæˆåï¼ŒApp.tsx å°†ä» 758 è¡Œå‡å°‘åˆ°çº¦ 500 è¡Œï¼Œå‡å°‘äº†çº¦ 250 è¡Œä»£ç ï¼

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **å®Œæ•´è®¡åˆ’**: æŸ¥çœ‹ `æ‹†åˆ†è®¡åˆ’-ç¬¬ä¸‰é˜¶æ®µ-è¯¦ç»†åˆ†æ.md`
- **æ€»ç»“**: æŸ¥çœ‹ `ç¬¬ä¸‰é˜¶æ®µæ‹†åˆ†æ€»ç»“.md`

