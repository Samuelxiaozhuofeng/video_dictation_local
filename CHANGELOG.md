# 更新日志

## [2024-11-20] - 重大功能更新

### ✨ 新增功能

#### 1. 标点符号自动显示
- **功能**: 字幕中的标点符号不再需要用户输入，自动显示在输入框之间
- **优势**: 
  - 减少 10-20% 的输入量
  - 用户可以专注于单词学习
  - 提高练习效率
- **实现**: 使用智能分词系统区分单词和标点符号

#### 2. 智能自动跳转
- **功能**: 实时检测输入正确性，自动跳转到下一个输入框
- **特性**:
  - 输入正确的单词立即跳转（绿色高亮反馈）
  - 所有单词正确后自动重播当前字幕
  - 重播完成后自动进入下一个字幕
- **优势**: 
  - 流畅的学习体验
  - 即时反馈
  - 自动化的学习流程

#### 3. 多语言 Unicode 支持 🌍
- **功能**: 完整支持所有 Unicode 字符
- **支持的语言**:
  - ✅ 西班牙语 (ñ, á, é, í, ó, ú, ü)
  - ✅ 法语 (à, â, ç, è, é, ê, ë, î, ï, ô, ù, û, ü, ÿ)
  - ✅ 德语 (ä, ö, ü, ß)
  - ✅ 葡萄牙语 (ã, õ, ç)
  - ✅ 中文、日文、韩文
  - ✅ 阿拉伯语、希伯来语
  - ✅ 俄语、希腊语
  - ✅ 所有其他 Unicode 语言
- **修复**: 解决了西班牙语字符被误识别为标点符号的问题

### 🔧 技术改进

#### 新增文件
1. **utils/textTokenizer.ts** (104 行)
   - 智能文本分词工具
   - 支持 Unicode 字符
   - 提供输入验证功能
   - 完全类型安全 (TypeScript)

#### 修改文件
1. **components/InputFeedback.tsx**
   - 集成新的分词系统
   - 实现自动检测和跳转逻辑
   - 优化 UI 渲染
   - 添加视觉反馈（绿色高亮）

#### 依赖更新
- 添加 `@types/react` (开发依赖)
- 添加 `@types/react-dom` (开发依赖)

### 🧪 测试

#### 测试文件
1. **test-tokenizer.js** - 分词器单元测试
   - 6/6 测试用例通过 ✅
   - 覆盖西班牙语、英语、混合标点等场景

2. **TEST_SUBTITLES.srt** - 英语测试字幕
   - 包含缩写、标点符号等

3. **TEST_SPANISH_SUBTITLES.srt** - 西班牙语测试字幕
   - 包含 ñ, ó, á, é, í, ú 等特殊字符
   - 包含西班牙语特有标点 ¿ ¡

#### 测试结果
```
📊 Results: 6 passed, 0 failed out of 6 tests
🎉 All tests passed! Unicode support is working correctly.
```

### 📚 文档

#### 新增文档
1. **FEATURE_UPDATE.md** - 功能更新详细说明
2. **IMPLEMENTATION_SUMMARY.md** - 技术实现总结
3. **UNICODE_FIX.md** - Unicode 支持修复说明
4. **QUICK_START.md** - 快速开始指南
5. **CHANGELOG.md** - 本文档

### 🎨 UI/UX 改进

#### 视觉反馈
- ✅ 正确输入: 绿色边框 + 浅绿色背景
- ⏳ 未完成: 白色边框
- 🎯 焦点状态: 蓝色边框

#### 用户提示
- 更新提示文本: "Type words • Auto-advance when correct • Space to Next"
- 标点符号以静态文本显示，自然排列

### 🔄 向后兼容性

#### 保持不变的功能
- ✅ Anki 集成
- ✅ AI 单词定义
- ✅ 收藏功能
- ✅ 视频分段
- ✅ 播放控制
- ✅ 设置配置
- ✅ 所有现有数据格式

#### 无需迁移
- ✅ 现有的 localStorage 数据完全兼容
- ✅ 现有的 SRT 文件格式不变
- ✅ 现有的配置保持有效

### 🐛 Bug 修复

#### 关键修复
1. **Unicode 字符识别问题** ⭐
   - **问题**: 西班牙语等非英语字符被识别为标点符号
   - **影响**: 无法正常输入 ñ, ó, á 等字符
   - **修复**: 更新正则表达式使用 Unicode 属性 `\p{L}` 和 `\p{N}`
   - **状态**: ✅ 已修复并测试通过

### 📊 性能优化

#### 优化点
1. **useMemo 缓存**: tokens 和 wordTokens 使用 useMemo 缓存
2. **条件渲染**: 只渲染必要的元素
3. **智能聚焦**: 使用 setTimeout 确保 DOM 更新完成

### 🚀 使用方法

#### 基础使用
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 运行测试
node test-tokenizer.js
```

#### 测试新功能
1. 使用 `TEST_SPANISH_SUBTITLES.srt` 测试西班牙语支持
2. 观察标点符号自动显示
3. 体验自动跳转功能
4. 查看绿色高亮反馈

### 💡 下一步计划

#### 可能的增强
1. **智能提示**: 显示单词的首字母提示
2. **难度调整**: 根据用户水平调整自动跳转的严格程度
3. **统计分析**: 记录每个单词的正确率
4. **键盘快捷键**: 添加更多快捷键支持
5. **语音输入**: 集成语音识别功能
6. **进度显示**: 显示当前完成进度（如 3/5 单词）

#### 用户反馈收集
- 自动跳转的延迟是否合适？
- 视觉反馈是否清晰？
- 是否需要"严格模式"选项？
- 是否需要更多语言特定的功能？

### 🙏 致谢

感谢用户反馈西班牙语字符识别问题，这促使我们实现了完整的 Unicode 支持，使应用能够服务于全球所有语言的学习者！

---

## 版本信息

- **版本**: 1.1.0
- **发布日期**: 2024-11-20
- **兼容性**: 所有现代浏览器 (Chrome 64+, Firefox 78+, Safari 11.1+, Edge 79+)
- **Node.js**: 10+

## 获取帮助

如有问题或建议，请查看:
- `QUICK_START.md` - 快速开始指南
- `FEATURE_UPDATE.md` - 功能详细说明
- `UNICODE_FIX.md` - Unicode 支持说明

